<!DOCTYPE html>
<html>
  <head>
    <script src="../dist/obj-obs.js" ></script>
    <script>
console.log('obs-obs');
const ObjObserver = ObjObs.default;
const obs = new ObjObserver();
const container = {
  objs: null,
};

const createObjs = () => {
  obs2.set(container, 'objs',  Array.from({length: 20000}, (v, k) => k).map(i => {
    return {
      a: {
        _n: "a",
        _v: 1,
        b: {
          _n: "b",
          _v: 1,
          c: {
            _n: "c",
            _v: 1,
            d: 1
          },
          e: {
            _n: "e",
            _v: 1,
            f: 1
          }
        }
      }
    };
  }));
};

const deleteObjs = () => {
  obs2.set(container, 'objs', null);
}

const callback1 = ({...args}) => {
  console.log(...args);
};

const observe = () => {
  container.objs.forEach(obj => {
    obs.observe(obj,'a.b.c.d', callback1);
  });
};

const unobserve = () => {
  container.objs.forEach(obj => {
    obs.unobserve(obj,'a.b.c.d', callback1);
  });
};

const onObjsChange = ({newValue}) => {
  if (newValue) {
    document.querySelector('#count').innerHTML = newValue.length;
    document.querySelector('#observe button').disabled = false;
    document.querySelector('#unobserve button').disabled = false;
  } else {
    document.querySelector('#count').innerHTML = 0;
    document.querySelector('#observe button').disabled = true;
    document.querySelector('#unobserve button').disabled = true;
  }
}

const obs2 = new ObjObserver();

obs2.observe(container, 'objs', onObjsChange);

    </script>
  </head>
  <body>
    
    <p id="create">
      <button onclick="createObjs();">Create Objects</button>
    </p>
    
    <p id="delete">
      <button onclick="deleteObjs();">Remove Objects</button>
    </p>

    <p id="observe" >
      <button onclick="observe();" disabled>Observe</button>
    </p>

    <p id="unobserve" >
      <button onclick="unobserve();" disabled>Unobserve</button>
    </p>

    <p id="count"></p>

  </body>
</html>